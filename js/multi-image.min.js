(function(e,h,i){var g=h.wp.customize;var b={open:function(){var m=wp.media.frames.file_frame;if(m){m.open();return}m=wp.media.frames.file_frame=wp.media({multiple:true,library:{type:"image"}});m.on("select",function(){var n=m.state().get("selection").toJSON(),o=[];i.each(n,function(p){o.push(p.url)});g.Events.trigger("mic:urls-available",o)});m.open()}};var d=Backbone.View.extend({tagName:"a",initialize:function(){this.$el.on("click",b.open)}});var j=Backbone.View.extend({tagName:"a",empty_urls:function(){g.Events.trigger("mic:urls-available",[])},handle_visibility:function(m){if(m.length){this.$el.show();return}this.$el.hide()},initialize:function(){this.$el.on("click",this.empty_urls);g.Events.bind("mic:urls-available",i.bind(this.handle_visibility,this))}});var a=Backbone.Model.extend({});var l=Backbone.Collection.extend({model:a});var k=Backbone.View.extend({tagName:"li",className:"thumbnail"});var c=Backbone.View.extend({tagName:"li",className:"placeholder",template:i.template('<span class="message"><%= no_images_selected_label %></span>'),render:function(){this.$el.html(this.template(_MultiImageControl.l10n));return this}});var f=Backbone.View.extend({initialize:function(){this.model.on("change reset set",this.render,this)},get_urls:function(m){var n=[],o=e(m).find("li.thumbnail");i.each(o,function(p){n.push(e(p).data("src"))});return n},make_sortable:function(){var m=this;this.$el.sortable({update:function(){g.Events.trigger("mic:urls-available",m.get_urls(this))}}).disableSelection()},render:function(){this.$el.empty();var m=this.model.models;if(m.length===0){this.$el.append(new c().render().$el);return}else{i.each(m,function(n){var p=n.attributes.src;var o=new k({attributes:{style:"background-image: url("+p+")","data-src":p}});this.$el.append(o.$el)},this);this.make_sortable()}return this}});g.MultiImage=g.Control.extend({prepare_setting_urls:function(m){m=m.length?m.join(","):"";return m},update_setting:function(m){this.setting.set(this.prepare_setting_urls(m))},udpdate_srcs_collection:function(n){var m=[];i.each(n,function(o){m.push(new a({collection:this.srcs,src:o}))},this);this.srcs.reset(m)},update:function(m){this.update_setting(m);this.udpdate_srcs_collection(m)},extract_setting_urls:function(){var m=this.setting.get().length?this.setting.get().split(","):[];return m},ready:function(){this.upload_button=new d({el:this.container.find("a.upload")});this.remove_button=new j({model:this,el:this.container.find("a.remove")});this.srcs=new l();this.thumbnails=new f({model:this.srcs,el:this.container.find("ul.thumbnails")});g.Events.bind("mic:urls-available",i.bind(this.update,this));g.Events.trigger("mic:urls-available",this.extract_setting_urls())}});e.extend(g.controlConstructor,{multi_image:g.MultiImage})})(jQuery,window,window._);